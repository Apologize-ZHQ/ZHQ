# ARP地址解析协议
功能：根据IP地址获取主机的MAC物理地址。

注意：ARP分组使用的是IP协议进行传输，因此，ARP协议划分为网络层协议；

ARP原理:  
主机A中的ARP高速缓存，存储本地局域网中各主机的和路由器的IP地址到MAC物理地址的映射表。  
当主机A向主机B发送IP数据报时，先在主机A的ARP高速缓存中查看有无主机B的IP地址；  
若有， 则在ARP高速缓存中查找出其对应的MAC地址，将MAC地址写入数据链路层的MAC帧中，将MAC帧发送至目的MAC地址。  
若无，主机A则自动运行ARP协议。  

ARP协议执行过程：

在同一局域网中  
1. 主机A的ARP进程在本局域网中广播ARP请求分组。  
2. 本局域网中的所有主机上运行的ARP进程都会收到该ARP请求分组。  
3. 主机B的IP地址与ARP请求分组中的IP地址一致，则收下该ARP请求分组。并向主机A发送ARP响应分组，并在该ARP响应分组中添加自己的MAC地址。    
该局域网中其他主机由于IP地址与该ARP请求分组中IP地址不一致，因此，对该ARP请求分组不予理睬，  
4. 主机A收到主机B的ARP响应分组，从ARP响应分组中提取主机B的MAC地址，并将主机B的IP地址和MAC地址的映射写入到本机的ARP高速缓存中。  

注意
1. ARP请求分组时广播的，ARP响应分组是单播的  
2. 主机B在接收到主机A的ARP请求分组时， 就可以从ARP请求分组中提取主机A的IP地址和MAC地址，并写入到本机B的ARP高速缓存中    

ARP四种使用情形：

A B  路由器R1  C  路由器R2  D

1. 主机A发送IP数据报到主机B中。 主机A发送ARP请求分组，找到主机B地物理地址.  
2. 主机A发送IP数据报到主机 C（D）上。主机A发送ARP请求分组，在网络1上广播，找到网络1上的路由器R1的Mac地址。剩余的工作由路由器R1完成.  
3. 路由器R1将IP数据报发送至主机C。 路由器R1 向网络2广播ARP请求分组，找到主机C的硬件地址。  
4. 路由器R1向主机D发送IP数据报。路由器R1向网络2广播ARP请求分组，获得网络2上的路由器R2的Mac地址，剩余工作由路由器R2完成。  

为什么不使用MAC地址进行通信？  
由于全世界存在不同的网络，这些不同的网络使用不同的物理地址。如果要使这些不同的网络之间进行通信，那么必须进行非常复杂的硬件地址转换工作。 